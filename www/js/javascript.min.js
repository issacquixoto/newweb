$(document).ready(function(){function e(){g={body:3,sta:3,int:3,feel:3,will:3}}function t(){$("#skillPoint tr:not(.createSkill)").remove(),s("skill1"),$.each(w,function(e,t){delete w[e]})}function i(){}function n(){$("#otherRaceCorrection option:first").prop("selected","selected"),C={}}function o(){var e=0;$.each(g,function(t,i){e+=i}),h=x[y]-e,$("#overRacePoint").text(h)}function a(){var e=0;$.each(w,function(t,i){e+=v(i.level)}),m=void 0!==w.skill0?M[k]-e+6:M[k]-e,$("#overskillPoint").text(m)}function l(){}function s(e){var t;$.each(R,function(e,i){var n='<option value="'+e+'">'+i.main+"</option>";t+=n}),"skill0"===e?$("#skillPoint").prepend('<tr class="'+e+'" style="background: #7fffd4"><td class="chooseSkill"><select name="'+e+'" autocomplete="off"><option>付丧神赠送技能</option>'+t+'</select></td><td class="chooseSubSkill"><select name="'+e+'" autocomplete="off" disabled="disabled"></select></td><td class="minus"><input class="'+e+'" type="button" value="-"></td><td class="skillLevel">3</td><td class="add"><input class="'+e+'" type="button" value="+"></td><td><div class="error error_11">请先选择技能</div><div class="error error_12">付丧神赠送技能等级不能低于3级或超过5级</div></td></tr>'):$("#skillPoint .createSkill").before('<tr class="'+e+'"><td class="chooseSkill"><select name="'+e+'" autocomplete="off"><option></option>'+t+'</select></td><td class="chooseSubSkill"><select name="'+e+'" autocomplete="off" disabled="disabled"></select></td><td class="minus"><input class="'+e+'" type="button" value="-"></td><td class="skillLevel">0</td><td class="add"><input class="'+e+'" type="button" value="+"></td><td><div class="error error_11">请先选择技能</div><div class="error error_12">新建角色技能等级不能低于0级或超过4级</div></td></tr>')}function r(e){var t;$.each(F,function(e,i){var n='<option value="'+e+'">'+i.name+"</option>";t+=n});var i='<tr class="'+e+'"><td class="chooseStunt"><select name="'+e+'" autocomplete="off"><option></option>'+t;$("#stuntPoint .createStunt").before(i+'</select></td><td class="chooseSubStunt"><select name="'+e+'" autocomplete="off" disabled="disabled"></select></td><td class="minus"><input class="'+e+'" type="button" value="-"></td><td class="stuntLevel">0</td><td class="add"><input class="'+e+'" type="button" value="+"></td><td><div class="error error_21">请先选择能力或特技</div><div class="error error_22">新建角色特技等级不能低于0级或超过4级</div></td></tr>')}function c(){$("#raceRankPoint").text(x[y]),$.each(g,function(e,t){$("."+e+"Point .point").html(t),void 0===C[e]?($("."+e+"Point .amend").html(P[e]),_[e]=P[e]+t):($("."+e+"Point .amend").html(P[e]+C[e]),_[e]=P[e]+C[e]+t),$("."+e+"Point .total").html(_[e])});var e=$("#subCharacterPoint"),t=Math.ceil((_.int+_.feel)/3);t<2&&(t=2),e.find(".hp .value").html(10+4*_.sta),e.find(".mp .value").html(4*_.will),e.find(".dp .value").html(10+_.body+_.sta+_.will),e.find(".dpRecover .value").html(t),e.find(".dpRecover .value").html("2")}function d(){$("#skillRankPoint").text(M[k]),$.each(w,function(e,t){$("tr."+e+" .skillLevel").html(t.level)})}function p(){$("#stuntRankPoint").text(S[b])}function v(e){var t=0;e=Math.floor(e);for(var i=0;i<=e;i++)t+=i>5?5:i;return t}function u(e){return e>5?5:e}var h,m,f,y,k,b,g={body:3,sta:3,int:3,feel:3,will:3},w={},P={},C={},_={},I={a1:{point:26,correction:{body:2,sta:2,int:0,feel:0,will:1}},a2:{point:26,correction:{body:0,sta:0,int:2,feel:0,will:1}},b1:{point:24,correction:{body:0,sta:0,int:1,feel:0,will:2}},b2:{point:24,correction:{body:1,sta:1,int:0,feel:1,will:0}},b3:{point:24,correction:{body:1,sta:1,int:0,feel:0,will:0}},b4:{point:24,correction:{body:1,sta:0,int:0,feel:2,will:0}},c1:{point:22,correction:{body:-1,sta:-1,int:1,feel:0,will:1}},c2:{point:22,correction:{body:0,sta:0,int:1,feel:1,will:-1}},c3:{point:22,correction:{body:0,sta:0,int:0,feel:0,will:0}},c4:{point:22,correction:{body:1,sta:1,int:-1,feel:1,will:-1}},d1:{point:20,correction:{body:0,sta:0,int:0,feel:0,will:0}},d2:{point:20,correction:{body:-1,sta:-1,int:-1,feel:2,will:-1}}},x={a:26,b:24,c:22,d:20},M={a:50,b:42,c:34,d:26},S={a:30,b:25,c:20,d:15},R={shooting:{main:"射击"},barrage:{main:"弹幕"},avoid:{main:"回避"},chaseShooting:{main:"追击"},shootingWeapons:{main:"射击武器"},meleeWeapon:{main:"近战武器"},movement:{main:"运动",flight:"飞行",groundMovement:"地面运动",swimming:"游泳"},perception:{main:"感知",vision:"目视",hearing:"聆听",smell:"嗅味",touch:"触摸",fantasy:"感知神秘"},resistance:{main:"抵抗"},shouting:{main:"呼喊"},song:{main:"歌唱"},instrument:{main:"乐器"},dance:{main:"舞蹈"},painting:{main:"绘画"},carving:{main:"雕刻"},doll:{main:"人偶"},literature:{main:"文学"},tricks:{main:"戏法"},divination:{main:"占卜"},imagination:{main:"想象"},life:{main:"生活",foodCollection:"食物采集",cook:"料理",housekeeping:"家务",hunting:"狩猎",farming:"农耕"},work:{main:"工作",woodwork:"木工",masonry:"石工",forged:"锻造",tailor:"裁缝",pottery:"陶艺"},gardener:{main:"园艺师"},ninja:{main:"忍术",secret:"隐密",change:"变装",hide:"隐匿",trace:"追迹"},thieves:{main:"盗贼",trap:"陷阱",cipher:"暗号",unlock:"开锁",engraved:"印"},chemistry:{main:"化学"},physics:{main:"物理学"},psychology:{main:"心理学"},fantasyKnowledge:{main:"幻想知识",magic:"魔法知识",godSurgery:"神术·阴阳术知识",attribute:"属性知识",monster:"妖怪知识",heritage:"传承·神话知识"},natureKnowledge:{main:"自然知识",animal:"动物知识",plant:"植物知识",insect:"昆虫知识",meteorological:"气象知识",geographical:"地理知识"},anecdoteKnowledge:{main:"逸闻知识"},historyKnowledge:{main:"历史知识"},martialArtsKnowledge:{main:"武术知识"},areaKnowledge:{main:"地区知识"},documentKnowledge:{main:"文献检索"},japaneseKnowledge:{main:"日语"},englishKnowledge:{main:"英语"},runesKnowledge:{main:"符文"},ancientWritings:{main:"古文"},medical:{main:"医术",knowledge:"医学知识",pharmacy:"药学",firstAid:"急救",surgery:"手术",veterinary:"兽医"},talk:{main:"交涉",lying:"说谎",business:"商业",breakLies:"识破谎言",etiquette:"礼仪规范",winOver:"笼络",report:"报道",gaze:"凝视"}},F={gods:{name:"神术·阴阳术"},surgery:{name:"神术·阴阳术（术式）"},magic:{name:"魔法"},property:{name:"属性使"},sorcery:{name:"妖术"},fairyPower:{name:"妖术"},sorceryBullet:{name:"妖术（妖弹化）"},exercise:{name:"锻炼"},qigong:{name:"气功"},magicItem1:{name:"魔法道具I"},magicItem2:{name:"魔法道具II"},potions:{name:"魔药"},animalCommunication:{name:"动物交流",cost:4},aquatic:{name:"水栖",cost:2},turned:{name:"变身",cost:5},spiritualization:{name:"灵体化",cost:8},darkVision:{name:"黑暗视觉"},judgeSmall:{name:"被弹判定小",cost:8},grazeBig:{name:"擦弹判定大",cost:8},hadouken:{name:"剑闪/波动",cost:5},highSpeedFlight:{name:"高速飞行"},concentration:{name:"集中力",cost:8},silverWeapon:{name:"纯银武器",cost:2},magicBag:{name:"魔法袋",cost:3},magicBook:{name:"魔法书",cost:5},realThing:{name:"真实之物"},civilizedWeapon:{name:"文明利器"},addMark:{name:"追加刻符"},addFriend:{name:"增加关系人"},addMoney:{name:"增加财产"},addHP:{name:"增加HP"},addMP:{name:"增加灵力"},addSC:{name:"增加符卡"},house:{name:"别墅",cost:3},magicHouse:{name:"魔法屋",cost:5},news:{name:"报社",cost:10},dolls:{name:"使魔/式神/仆人/人偶/傀儡"},magicWeapon:{name:"魔法武器/利剑/魔法防具"}};$("#characterRace").on("change",function(){f=$(this).find("option:selected").val(),P=I[f].correction,$(".error").css("display","none"),n(),$("#otherRaceCorrection > div").css("display","none"),"c3"===f?$("#otherRaceCorrection .c3Choose").css("display","block"):"b3"===f&&$("#otherRaceCorrection .other01").css("display","block"),"c3"===f?s("skill0"):($("#skillPoint .skill0").remove(),delete w.skill0),a(),c()}),$("#attributeRank").on("change",function(){e(),y=$(this).find("option:selected").val(),void 0===f&&(P=I.a1.correction),$(".error").css("display","none"),o(),c()}),$('#characterPoint input[value="+"]').on("click",function(){var e=$(this).attr("class");h<=0?$(".error_04").css("display","block"):(void 0===f&&(P=I.a1.correction),void 0===y&&(y="a"),g[e]<6?(++g[e],$(".error_01").css("display","none"),$(".error_02").css("display","none"),o(),c()):$("."+e+"Point .error_02").css("display","inline-block"))}),$('#characterPoint input[value="-"]').on("click",function(){var e=$(this).attr("class");$(".error_04").css("display","none"),void 0===f&&(P=I.a1.correction),void 0===y&&(y="a"),g[e]>3?(--g[e],$(".error_01").css("display","none"),$(".error_02").css("display","none"),o(),c()):$("."+e+"Point .error_01").css("display","inline-block")}),$("#otherRaceCorrection input").on("change",function(){var e=$(this).attr("name"),t=$('input[name="'+e+'"]:checked').val();"c3Choose"===e&&"add1"===t&&($("#otherRaceCorrection > div").css("display","none"),$("#otherRaceCorrection .other01").css("display","inline-block")),"c3Choose"===e&&"add3"===t&&$("#otherRaceCorrection > div").css("display","inline-block"),$("#otherRaceCorrection .c3Choose").css("display","block"),n(),c()}),$("#otherRaceCorrection select").on("change",function(){var e=$(this).attr("name"),t=$(this).val(),i=C[e];"other01"!==e&&"other02"!==e||(void 0===C[t]?C[t]=1:++C[t],void 0!==i&&void 0!==C[t]&&--C[i]),"other03"===e&&(void 0===C[t]?C[t]=-1:--C[t],void 0!==i&&void 0!==C[t]&&++C[i]),C[e]=t,o(),c()}),s("skill1"),$("#skillRank").on("change",function(){t(),k=$(this).find("option:selected").val(),$(".error").css("display","none"),a(),d()}),$("#skillPoint").on("change",".chooseSkill select",function(){var e,t=$(this).attr("name"),i=$(this).val(),n=R[i];void 0===k&&(k="a"),$.each(n,function(t,i){e+="main"===t?'<option value="'+t+'" selected="selected">'+i+"</option>":'<option value="'+t+'">'+i+"</option>"}),$("tr."+t+" .chooseSubSkill select").attr("disabled",!1).html(e),$(".error").css("display","none"),"skill0"===t?w.skill0={name:i,level:3}:w[t]={name:i,level:0},a(),d()}),$("#skillPoint").on("click",'input[value="+"]',function(){var e=$(this).attr("class");if($(".error").css("display","none"),"skill0"===e){if(void 0===w.skill0)return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level>=5)return void $("tr."+e+" .error_12").css("display","inline-block");if(m-u(w[e].level+1)<0)return void $(".error_14").css("display","inline-block");++w[e].level}else{if(void 0===w[e])return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level>=4)return void $("tr."+e+" .error_12").css("display","inline-block");if(m-u(w[e].level+1)<0)return void $(".error_14").css("display","inline-block");++w[e].level}a(),d()}),$("#skillPoint").on("click",'input[value = "-"]',function(){var e=$(this).attr("class");if($(".error").css("display","none"),"skill0"===e){if(void 0===w.skill0)return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level<=3)return void $("tr."+e+" .error_12").css("display","inline-block");--w[e].level}else{if(void 0===w[e])return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level<=0)return void $("tr."+e+" .error_12").css("display","inline-block");--w[e].level}a(),d()}),$("#createSkill").on("click",function(){var e=$("#skillPoint tr:nth-last-of-type(2)").attr("class");e=e.replace(/skill/,""),s(e="skill"+ ++e)}),r("stunt1"),$("#stuntRank").on("change",function(){i(),b=$(this).find("option:selected").val(),$(".error").css("display","none"),l(),p()}),$("#StuntPoint").on("click",'input[value="+"]',function(){var e=$(this).attr("class");if($(".error").css("display","none"),"skill0"===e){if(void 0===w.skill0)return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level>=5)return void $("tr."+e+" .error_12").css("display","inline-block");if(m-u(w[e].level+1)<0)return void $(".error_14").css("display","inline-block");++w[e].level}else{if(void 0===w[e])return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level>=4)return void $("tr."+e+" .error_12").css("display","inline-block");if(m-u(w[e].level+1)<0)return void $(".error_14").css("display","inline-block");++w[e].level}a(),d()}),$("#StuntPoint").on("click",'input[value = "-"]',function(){var e=$(this).attr("class");if($(".error").css("display","none"),"skill0"===e){if(void 0===w.skill0)return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level<=3)return void $("tr."+e+" .error_12").css("display","inline-block");--w[e].level}else{if(void 0===w[e])return void $("tr."+e+" .error_11").css("display","inline-block");if(w[e].level<=0)return void $("tr."+e+" .error_12").css("display","inline-block");--w[e].level}a(),d()}),$("#createStunt").on("click",function(){var e=$("#stuntPoint tr:nth-last-of-type(2)").attr("class");e=e.replace(/stunt/,""),r(e="skill"+ ++e)})}),$(document).ready(function(){function e(){var e=parseInt(o("#player1","left"));e<=0?$("#player1").css("left",e+"px"):$("#player1").css("left",e-v+"px")}function t(){var e=parseInt(o("#player1","top"));e<=0?$("#player1").css("top",e+"px"):$("#player1").css("top",e-v+"px")}function i(){var e=$("#gbody").width()-10,t=parseInt(o("#player1","left"));t>=e?$("#player1").css("left",t+"px"):$("#player1").css("left",t+v+"px")}function n(){var e=$("#gbody").height()-10,t=parseInt(o("#player1","top"));t>=e?$("#player1").css("top",t+"px"):$("#player1").css("top",t+v+"px")}function o(e,t){var i=/\d+/;return $(e).css(t).match(i)[0]}function a(){$("#My-bullet >div").each(function(){var e=parseInt(o(this,"top")),t=parseInt(o(this,"left")),i=e+parseInt($(this).attr("top")),n=t+parseInt($(this).attr("left"));e<=10||e>=600?$(this).remove():t<=10||t>=790?$(this).remove():$(this).css({top:i+"px",left:n+"px"})}),$("#enemy-bullet >div").each(function(){var e=parseInt(o(this,"top")),t=parseInt(o(this,"left")),i=e+parseInt($(this).attr("top")),n=t+parseInt($(this).attr("left"));e<=10||e>=600?$(this).remove():t<=10||t>=790?$(this).remove():$(this).css({top:i+"px",left:n+"px"})})}function l(e){return{t:parseInt(o(e,"top")),h:parseInt(o(e,"top"))+parseInt(o(e,"height")),l:parseInt(o(e,"left")),w:parseInt(o(e,"left"))+parseInt(o(e,"width"))}}function s(e,t){var i=l(t),n=l(e);n.t>=i.t&&n.t<=i.h?r(e,t,i,n):n.h>=i.t&&n.h<=i.h&&r(e,t,i,n)}function r(e,t,i,n){n.l>=i.l&&n.l<=i.w?c(e,t):n.w>=i.l&&n.w<=i.w&&c(e,t)}function c(e,t){e.remove();var i=t.attr("hp");i>1?t.attr("hp",i-1):t.remove(),i<5&&t.css("background","red")}function d(e,t,i,n,o){if(e.hasClass("hover")){var a=i.css("left"),l=i.css("top"),s=t+90,r=t+180,c=t-90,d=(Math.sin(t*Math.PI/180)*o).toFixed(8),p=(-Math.cos(t*Math.PI/180)*o).toFixed(8),v=(Math.sin(s*Math.PI/180)*o).toFixed(8),u=(-Math.cos(s*Math.PI/180)*o).toFixed(8),h=(Math.sin(r*Math.PI/180)*o).toFixed(8),m=(-Math.cos(r*Math.PI/180)*o).toFixed(8),f=(Math.sin(c*Math.PI/180)*o).toFixed(8),$="<div class='bullet' style='left:"+a+";top:"+l+"' top='"+p+"' left='"+d+"'></div>",y="<div class='bullet' style='left:"+a+";top:"+l+"' top='"+u+"' left='"+v+"'></div>",k="<div class='bullet' style='left:"+a+";top:"+l+"' top='"+m+"' left='"+h+"'></div>",b="<div class='bullet' style='left:"+a+";top:"+l+"' top='"+(-Math.cos(c*Math.PI/180)*o).toFixed(8)+"' left='"+f+"'></div>";n.append($),n.append(y),n.append(k),n.append(b)}}var p=0,v=15;$(document).keydown(function(e){switch(e.keyCode){case 37:$("#key .left").addClass("hover");break;case 38:$("#key .up").addClass("hover");break;case 39:$("#key .right").addClass("hover");break;case 40:$("#key .down").addClass("hover");break;case 90:$("#key .keyz").addClass("hover");break;case 88:$("#key .keyx").addClass("hover")}}),$(document).keyup(function(e){switch(e.keyCode){case 37:$("#key .left").removeClass("hover");break;case 38:$("#key .up").removeClass("hover");break;case 39:$("#key .right").removeClass("hover");break;case 40:$("#key .down").removeClass("hover");break;case 90:$("#key .keyz").removeClass("hover");break;case 88:$("#key .keyx").removeClass("hover")}}),setInterval(function(){$("#key .left").hasClass("hover")&&e(),$("#key .up").hasClass("hover")&&t(),$("#key .right").hasClass("hover")&&i(),$("#key .down").hasClass("hover")&&n(),a();var o=$("#player1"),l=$("#enemy .brick");$("#enemy-bullet >div").each(function(){s($(this),o)}),$("#My-bullet >div").each(function(){s($(this),l)})},100),setInterval(function(){p+=25;var e=$("#key .keyz"),t=$("#enemy .brick"),i=$("#enemy-bullet");d(e,p,t,i,15)},100),$(document).keypress(function(){$("#keydown").text($("#player1").css("top")),$("#keyup").text($("#player1").css("left"))}),$(document).keyup(function(){})});