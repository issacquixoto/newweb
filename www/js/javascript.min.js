$(document).ready(function(){function e(){p={body:3,sta:3,int:3,feel:3,will:3}}function t(){$("#otherRaceCorrection option:first").prop("selected","selected"),f={}}function o(){var e=0;$.each(p,function(t,o){e+=o}),a=u[c].point-e,$("#overRacePoint").text(a)}function i(){var e=0;$.each(h,function(t,o){e+=l(o.level)}),r=k[d]-e,$("#overskillPoint").text(r)}function n(){$("#raceRankPoint").text(u[c].point),$.each(p,function(e,t){$("."+e+"Point .point").html(t),void 0===f[e]?($("."+e+"Point .amend").html(v[e]),y[e]=v[e]+t):($("."+e+"Point .amend").html(v[e]+f[e]),y[e]=v[e]+f[e]+t),$("."+e+"Point .total").html(y[e])});var e=$("#subCharacterPoint"),t=Math.ceil((y.int+y.feel)/3);t<2&&(t=2),e.find(".hp .value").html(10+4*y.sta),e.find(".mp .value").html(4*y.will),e.find(".dp .value").html(10+y.body+y.sta+y.will),e.find(".dpRecover .value").html(t),e.find(".dpRecover .value").html("2")}function s(){$("#skillRankPoint").text(k[d]),$.each(h,function(e,t){$("tr."+e+" .skillLevel").html(t.level)})}function l(e){var t=0;e=Math.floor(e);for(var o=0;o<=e;o++)t+=o>5?5:o;return t}var a,r,c,d,p={body:3,sta:3,int:3,feel:3,will:3},h={skill0:{name:"",level:0}},v={},f={},y={},u={a1:{point:26,correction:{body:2,sta:2,int:0,feel:0,will:1}},a2:{point:26,correction:{body:0,sta:0,int:2,feel:0,will:1}},b1:{point:24,correction:{body:0,sta:0,int:1,feel:0,will:2}},b2:{point:24,correction:{body:1,sta:1,int:0,feel:1,will:0}},b3:{point:24,correction:{body:1,sta:1,int:0,feel:0,will:0}},b4:{point:24,correction:{body:1,sta:0,int:0,feel:2,will:0}},c1:{point:22,correction:{body:-1,sta:-1,int:1,feel:0,will:1}},c2:{point:22,correction:{body:0,sta:0,int:1,feel:1,will:-1}},c3:{point:22,correction:{body:0,sta:0,int:0,feel:0,will:0}},c4:{point:22,correction:{body:1,sta:1,int:-1,feel:1,will:-1}},d1:{point:20,correction:{body:0,sta:0,int:0,feel:0,will:0}},d2:{point:20,correction:{body:-1,sta:-1,int:-1,feel:2,will:-1}}},k={a:50,b:42,c:34,d:26};$("#characterRace").on("change",function(){e(),c=$(this).find("option:selected").val(),v=u[c].correction,$(".error").css("display","none"),t(),$("#otherRaceCorrection > div").css("display","none"),"c3"===c?$("#otherRaceCorrection .c3Choose").css("display","block"):"b3"===c&&$("#otherRaceCorrection .other01").css("display","block"),o(),n()}),$('#characterPoint input[value="+"]').on("click",function(){var e=$(this).attr("class");a<=0?$(".error_04").css("display","block"):(void 0===c&&(c="a1",v=u.a1.correction),p[e]<6?(++p[e],$(".error_01").css("display","none"),$(".error_02").css("display","none"),o(),n()):$("."+e+"Point .error_02").css("display","inline-block"))}),$('#characterPoint input[value="-"]').on("click",function(){var e=$(this).attr("class");$(".error_04").css("display","none"),void 0===c&&(c="a1",v=u.a1.correction),p[e]>3?(--p[e],$(".error_01").css("display","none"),$(".error_02").css("display","none"),o(),n()):$("."+e+"Point .error_01").css("display","inline-block")}),$("#otherRaceCorrection input").on("change",function(){var e=$(this).attr("name"),o=$('input[name="'+e+'"]:checked').val();"c3Choose"===e&&"add1"===o&&($("#otherRaceCorrection > div").css("display","none"),$("#otherRaceCorrection .other01").css("display","inline-block")),"c3Choose"===e&&"add3"===o&&$("#otherRaceCorrection > div").css("display","inline-block"),$("#otherRaceCorrection .c3Choose").css("display","block"),t(),n()}),$("#otherRaceCorrection select").on("change",function(){var e=$(this).attr("name"),t=$(this).val(),i=f[e];"other01"!==e&&"other02"!==e||(void 0===f[t]?f[t]=1:++f[t],void 0!==i&&void 0!==f[t]&&--f[i]),"other03"===e&&(void 0===f[t]?f[t]=-1:--f[t],void 0!==i&&void 0!==f[t]&&++f[i]),f[e]=t,o(),n()}),$("#skillRank").on("change",function(){d=$(this).find("option:selected").val(),i(),s()}),$("#skillPoint").on("change","select",function(){var e=$(this).attr("name"),t=$(this).val();void 0===d&&(d="a"),$(".error_11").css("display","none"),h[e]={name:t,level:0},i(),s()}),$("#skillPoint").on("click",'input[value="+"]',function(){var e=$(this).attr("class");void 0!==h[e]?h[e].level>=4?$("tr."+e+" .error_12").css("display","inline-block"):(++h[e].level,$(".error_06").css("display","none"),i(),s()):$("tr."+e+" .error_11").css("display","inline-block")}),$("#skillPoint").on("click",'input[value = "-"]',function(){var e=$(this).attr("class");void 0!==h[e]?h[e].level<=0?$("tr."+e+" .error_12").css("display","inline-block"):(--h[e].level,$(".error_06").css("display","none"),i(),s()):$("tr."+e+" .error_11").css("display","inline-block")}),$("#createSkill").on("click",function(){var e=$("#skillPoint tr:nth-last-of-type(2)").attr("class");e=e.replace(/skill/,""),e="skill"+ ++e,$("#skillPoint .createSkill").before('<tr class="'+e+'"><td class="chooseSkill"><select name="'+e+'" autocomplete="off"><option></option><option value="eat">吃饭</option></select></td><td class="minus"><input class="'+e+'" type="button" value="-"></td><td class="skillLevel">0</td><td class="add"><input class="'+e+'" type="button" value="+"></td><td><div class="error error_11">请先选择技能</div><div class="error error_12">新建角色技能等级不能低于0级或超过4级</div></td></tr>')})}),$(document).ready(function(){function e(){var e=parseInt(n("#player1","left"));e<=0?$("#player1").css("left",e+"px"):$("#player1").css("left",e-h+"px")}function t(){var e=parseInt(n("#player1","top"));e<=0?$("#player1").css("top",e+"px"):$("#player1").css("top",e-h+"px")}function o(){var e=$("#gbody").width()-10,t=parseInt(n("#player1","left"));t>=e?$("#player1").css("left",t+"px"):$("#player1").css("left",t+h+"px")}function i(){var e=$("#gbody").height()-10,t=parseInt(n("#player1","top"));t>=e?$("#player1").css("top",t+"px"):$("#player1").css("top",t+h+"px")}function n(e,t){var o=/\d+/;return $(e).css(t).match(o)[0]}function s(){$("#My-bullet >div").each(function(){var e=parseInt(n(this,"top")),t=parseInt(n(this,"left")),o=e+parseInt($(this).attr("top")),i=t+parseInt($(this).attr("left"));e<=10||e>=600?$(this).remove():t<=10||t>=790?$(this).remove():$(this).css({top:o+"px",left:i+"px"})}),$("#enemy-bullet >div").each(function(){var e=parseInt(n(this,"top")),t=parseInt(n(this,"left")),o=e+parseInt($(this).attr("top")),i=t+parseInt($(this).attr("left"));e<=10||e>=600?$(this).remove():t<=10||t>=790?$(this).remove():$(this).css({top:o+"px",left:i+"px"})})}function l(e){return{t:parseInt(n(e,"top")),h:parseInt(n(e,"top"))+parseInt(n(e,"height")),l:parseInt(n(e,"left")),w:parseInt(n(e,"left"))+parseInt(n(e,"width"))}}function a(e,t){var o=l(t),i=l(e);i.t>=o.t&&i.t<=o.h?r(e,t,o,i):i.h>=o.t&&i.h<=o.h&&r(e,t,o,i)}function r(e,t,o,i){i.l>=o.l&&i.l<=o.w?c(e,t):i.w>=o.l&&i.w<=o.w&&c(e,t)}function c(e,t){e.remove();var o=t.attr("hp");o>1?t.attr("hp",o-1):t.remove(),o<5&&t.css("background","red")}function d(e,t,o,i,n){if(e.hasClass("hover")){var s=o.css("left"),l=o.css("top"),a=t+90,r=t+180,c=t-90,d=(Math.sin(t*Math.PI/180)*n).toFixed(8),p=(-Math.cos(t*Math.PI/180)*n).toFixed(8),h=(Math.sin(a*Math.PI/180)*n).toFixed(8),v=(-Math.cos(a*Math.PI/180)*n).toFixed(8),$=(Math.sin(r*Math.PI/180)*n).toFixed(8),f=(-Math.cos(r*Math.PI/180)*n).toFixed(8),y=(Math.sin(c*Math.PI/180)*n).toFixed(8),u="<div class='bullet' style='left:"+s+";top:"+l+"' top='"+p+"' left='"+d+"'></div>",k="<div class='bullet' style='left:"+s+";top:"+l+"' top='"+v+"' left='"+h+"'></div>",b="<div class='bullet' style='left:"+s+";top:"+l+"' top='"+f+"' left='"+$+"'></div>",m="<div class='bullet' style='left:"+s+";top:"+l+"' top='"+(-Math.cos(c*Math.PI/180)*n).toFixed(8)+"' left='"+y+"'></div>";i.append(u),i.append(k),i.append(b),i.append(m)}}var p=0,h=15;$(document).keydown(function(e){switch(e.keyCode){case 37:$("#key .left").addClass("hover");break;case 38:$("#key .up").addClass("hover");break;case 39:$("#key .right").addClass("hover");break;case 40:$("#key .down").addClass("hover");break;case 90:$("#key .keyz").addClass("hover");break;case 88:$("#key .keyx").addClass("hover")}}),$(document).keyup(function(e){switch(e.keyCode){case 37:$("#key .left").removeClass("hover");break;case 38:$("#key .up").removeClass("hover");break;case 39:$("#key .right").removeClass("hover");break;case 40:$("#key .down").removeClass("hover");break;case 90:$("#key .keyz").removeClass("hover");break;case 88:$("#key .keyx").removeClass("hover")}}),setInterval(function(){$("#key .left").hasClass("hover")&&e(),$("#key .up").hasClass("hover")&&t(),$("#key .right").hasClass("hover")&&o(),$("#key .down").hasClass("hover")&&i(),s();var n=$("#player1"),l=$("#enemy .brick");$("#enemy-bullet >div").each(function(){a($(this),n)}),$("#My-bullet >div").each(function(){a($(this),l)})},100),setInterval(function(){p+=25;var e=$("#key .keyz"),t=$("#enemy .brick"),o=$("#enemy-bullet");d(e,p,t,o,15)},100),$(document).keypress(function(){$("#keydown").text($("#player1").css("top")),$("#keyup").text($("#player1").css("left"))}),$(document).keyup(function(){})});